// Reservily - Medical Appointment Booking Platform
// Prisma Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  DOCTOR
  PATIENT
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum AppointmentStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(PATIENT)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctorProfile         DoctorProfile?
  appointmentsAsPatient Appointment[]  @relation("PatientAppointments")

  @@map("users")
}

model DoctorProfile {
  id                    String             @id @default(uuid())
  userId                String             @unique
  specialty             String
  city                  String
  clinicAddress         String
  price                 Float
  bio                   String?
  experience            Int
  subscriptionStatus    SubscriptionStatus @default(INACTIVE)
  subscriptionExpiresAt DateTime?
  paymentProofUrl       String?
  paymentReference      String?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt

  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  availability Availability[]
  appointments Appointment[]  @relation("DoctorAppointments")

  @@map("doctor_profiles")
}

model Availability {
  id        String    @id @default(uuid())
  doctorId  String
  dayOfWeek DayOfWeek
  startTime String
  endTime   String
  createdAt DateTime  @default(now())

  doctor DoctorProfile @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@unique([doctorId, dayOfWeek])
  @@map("availabilities")
}

model Appointment {
  id        String            @id @default(uuid())
  doctorId  String
  patientId String
  date      DateTime
  time      String
  status    AppointmentStatus @default(PENDING)
  notes     String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  doctor  DoctorProfile @relation("DoctorAppointments", fields: [doctorId], references: [id], onDelete: Cascade)
  patient User          @relation("PatientAppointments", fields: [patientId], references: [id], onDelete: Cascade)

  @@map("appointments")
}

model PaymentSubmission {
  id              String    @id @default(uuid())
  doctorId        String
  amount          Float
  proofImageUrl   String
  referenceNumber String
  notes           String?
  isVerified      Boolean   @default(false)
  verifiedAt      DateTime?
  verifiedBy      String?
  createdAt       DateTime  @default(now())

  @@map("payment_submissions")
}
